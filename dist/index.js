var et=Object.create;var Xe=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var rt=Object.getOwnPropertyNames;var nt=Object.getPrototypeOf,ot=Object.prototype.hasOwnProperty;var st=(d,f)=>()=>(f||d((f={exports:{}}).exports,f),f.exports);var ct=(d,f,m,b)=>{if(f&&typeof f=="object"||typeof f=="function")for(let C of rt(f))!ot.call(d,C)&&C!==m&&Xe(d,C,{get:()=>f[C],enumerable:!(b=tt(f,C))||b.enumerable});return d};var it=(d,f,m)=>(m=d!=null?et(nt(d)):{},ct(f||!d||!d.__esModule?Xe(m,"default",{value:d,enumerable:!0}):m,d));var qe=st((gt,de)=>{(function(){"use strict";var d={}.hasOwnProperty,f="[native code]";function m(){for(var b=[],C=0;C<arguments.length;C++){var p=arguments[C];if(p){var Z=typeof p;if(Z==="string"||Z==="number")b.push(p);else if(Array.isArray(p)){if(p.length){var T=m.apply(null,p);T&&b.push(T)}}else if(Z==="object"){if(p.toString!==Object.prototype.toString&&!p.toString.toString().includes("[native code]")){b.push(p.toString());continue}for(var R in p)d.call(p,R)&&p[R]&&b.push(R)}}}return b.join(" ")}typeof de<"u"&&de.exports?(m.default=m,de.exports=m):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return m}):window.classNames=m})()});import ge,{useRef as x,useState as _e,useMemo as K,useCallback as g,useEffect as w}from"react";function O(d){if(!d)return d;let f=d;return f.transformedPoint=(m,b)=>{let C=new DOMPoint(m,b),p=f.getTransform();return C.matrixTransform(p.inverse())},f.untransformedPoint=(m,b)=>{let C=new DOMPoint(m,b),p=f.getTransform();return C.matrixTransform(p)},f}var Te=()=>null;var Le=()=>null;var Be=it(qe());import me from"react";var pe=({className:d,coords:f,children:m})=>me.createElement("div",{className:(0,Be.default)("RCMAP-tooltip",d),"data-x":f.x,"data-y":f.y},me.createElement("span",{className:"RCMAP-tooltip-arrow-outer"}),me.createElement("span",{className:"RCMAP-tooltip-arrow-inner"}),me.createElement("div",{className:"RCMAP-tooltip-body"},m));var at=1.1,ut=27,lt=ge.forwardRef(({image:d,children:f,onClick:m,onDoubleClick:b,onCursorMove:C,minZoom:p=.2,maxZoom:Z=5,overpan:T=30,minDragTime:R=300,clickGraceTime:Ae=100,containInitialImage:Ie=!0,containUpdatedImage:He=!0,allowContainmentZoom:te=!0,panTo:he},re)=>{let r=x(null),h=x(),ye=x(!1),z=x(!1),M=x(null),xe=x(void 0),ne=x(null),Y=x(+new Date),v=x(null),F=g(()=>{if(!r.current)return;let e=O(r.current.getContext("2d"));e&&v.current&&typeof C=="function"&&C(e.transformedPoint(v.current.x,v.current.y))},[C]),oe=x(!1),$=x(!1),se=x(null),ce=x(null),Ce=x(+new Date),U=x([]),ve=x([]),V=K(()=>{let e=[],t=n=>{if(Array.isArray(n))n.forEach(t);else{let o=n;o&&(o.props&&o.props.children&&o.type!==pe?t(o.props.children):e.push(o))}};return t(f),e},[f]);U.current=V.filter(e=>e.type&&e.type===Te);let N=e=>U.current.find(t=>t&&t.props.markerKey===e);ve.current=V.filter(e=>e.type&&e.type===Le);let $e=K(()=>V.filter(e=>e.type&&e.type===pe),[V]),k=()=>{if(!r.current)return null;let e=O(r.current.getContext("2d"));return e&&v.current?e.transformedPoint(v.current.x,v.current.y):null},Oe=({right:e,left:t,top:n,bottom:o,width:u,height:i})=>{if(!r.current)return{valid:!1};let a=r.current.getBoundingClientRect(),c=O(r.current.getContext("2d"));if(!c)return{valid:!1};let s={x:0,y:0},l={x:100,y:100};if(typeof n=="number")s.y=n,l.y=s.y+i;else if(typeof o=="number")s.y=a.height-o-i,l.y=s.y+i;else return{valid:!1};if(typeof t=="number")s.x=t,l.x=s.x+u;else if(typeof e=="number")s.x=a.width-e-u,l.x=s.x+u;else return{valid:!1};return s=c.transformedPoint(s.x,s.y),l=c.transformedPoint(l.x,l.y),{topLeft:s,bottomRight:l,valid:!0}},ie=g(()=>{let e=k();if(e===null)return;let t;return ve.current.forEach(n=>{let{right:o,left:u,top:i,bottom:a,width:c,height:s}=n.props,{topLeft:l,bottomRight:P,valid:W}=Oe({right:o,left:u,top:i,bottom:a,width:c,height:s});W&&e.x>=l.x&&e.x<=P.x&&e.y>=l.y&&e.y<=P.y&&(t=n)}),t},[]),X=g(()=>{if(!r.current)return null;let e=O(r.current.getContext("2d"));if(!e)return null;let t={},n=k();if(n===null)return null;U.current.forEach(i=>{let{markerKey:a,coords:c,size:s=100,scaleWithZoom:l=!0,onClick:P,onDoubleClick:W,dragZoneScale:B=1,onDragTick:ee,onDragEnd:j}=i.props;if(!(typeof P=="function"||typeof W=="function"||typeof ee=="function"||typeof j=="function"))return;let L=s/2*B,S=L*L,D;if(l)D=(c.x-n.x)**2+(c.y-n.y)**2;else{let A=e.untransformedPoint(c.x,c.y);D=(A.x-v.current.x)**2+(A.y-v.current.y)**2}D<S&&(t[a]=D)});let o=-1,u=[];return Object.keys(t).forEach(i=>{let a=t[i];o===-1||a<o?(o=a,u=[],u.push(i)):a===o&&u.push(i)}),u[0]||null},[]),ae=g(()=>{if(!r.current)return;X()?r.current.style.cursor="pointer":r.current.style.cursor="auto"},[X]),be=x(null),Ue=()=>{if(!r.current||!be.current)return;let e=r.current.getBoundingClientRect(),t=O(r.current.getContext("2d"));t&&Array.from(be.current.children).forEach(n=>{let o=n,u=Number(o.dataset.x),i=Number(o.dataset.y),a=t.untransformedPoint(u,i),c=a.x/e.width,s=a.y/e.height;o.style.setProperty("left",`${c*100}%`),o.style.setProperty("top",`${s*100}%`)})},Ze=x(+new Date),Ve=e=>{},y=g(e=>{if(!r.current)return;Ve(e);let t=O(r.current.getContext("2d"));if(!t)return;let n=t.transformedPoint(0,0),o=t.transformedPoint(r.current.width,r.current.height);t.clearRect(n.x,n.y,o.x-n.x,o.y-n.y),t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,r.current.width,r.current.height),t.restore(),h.current&&ye.current&&t.drawImage(h.current,0,0,h.current.width,h.current.height);let u=Math.min(t.getTransform().a,t.getTransform().d),i=c=>{let{coords:s,image:l,inCircle:P=!1,circleColour:W="#337ab7",size:B=100,scaleWithZoom:ee=!0}=c.props;if(!l)return;let j=1,L=1;l.width>l.height?L=l.height/l.width:j=l.width/l.height;let S=ee?B:B/u,D=s.x,A=s.y;if(P){let I=S*.55,H=I*j,E=I*L;t.beginPath(),t.arc(D,A,S/2,0,2*Math.PI,!1),t.fillStyle=W,t.fill(),t.drawImage(l,D-H/2,A-E/2,H,E)}else{let I=S*j,H=S*L;t.drawImage(l,D-I/2,A-H/2,I,H)}},a=N(M.current||"");if(U.current.filter(c=>c!==a).map(i),a&&z.current){let c=ie(),s=l=>{let{right:P,left:W,top:B,bottom:ee,width:j,height:L,label:S,colour:D="#fff",backgroundColour:A="#0f0",fontSize:I=24,image:H}=l.props,{topLeft:E,bottomRight:_,valid:Je}=Oe({right:P,left:W,top:B,bottom:ee,width:j,height:L});Je&&(t.globalAlpha=l===c?1:.7,t.beginPath(),t.fillStyle=A,t.fillRect(E.x,E.y,_.x-E.x,_.y-E.y),H&&t.drawImage(H,E.x,E.y,_.x-E.x,_.y-E.y),t.textAlign="center",t.fillStyle=D,t.font=`${I/u}px Arial`,S&&t.fillText(S,(_.x+E.x)/2,(_.y+E.y)/2+I/4/u),t.globalAlpha=1)};ve.current.map(s)}U.current.filter(c=>c===a).map(i),Ue(),ae()},[ie,ae]);w(()=>{y("new children")},[V,y]);let ze=g(()=>{if(!r.current)return;let e=r.current.getContext("2d");if(!e)return;let t=e.getTransform(),n=Math.max(t.a,t.d);e.setTransform(n,0,0,n,t.e,t.f),y("view reset")},[y]),[q,Qe]=_e(1),we=K(()=>te?Math.max(Z,q):Z,[te,Z,q]),Me=K(()=>te?Math.min(p,q):p,[te,p,q]),Ne=()=>{if(!r.current||!h.current)return;let e=h.current.width,t=h.current.height;if(e&&t){let n=t/e*r.current.width,o=1;n>r.current.height?o=r.current.height/t:o=r.current.width/e,Qe(o)}},[ue,Ge]=_e(!1),le=K(()=>()=>{if(ye.current=!0,!r.current||!h.current)return;let e=r.current.getContext("2d");if(!e)return;let t=h.current.width,n=h.current.height;if(t&&n){let o=!ue&&Ie||ue&&He,u=n/t*r.current.width,i=t/n*r.current.height,a=1;if(u>r.current.height){if(a=r.current.height/n,o){let c=e.getTransform(),s=a/c.d;e.scale(s,s),c=e.getTransform(),e.translate((-c.e+r.current.width/2-i/2)/c.a,-c.f/c.d)}}else if(a=r.current.width/t,o){let c=e.getTransform(),s=q/c.a;e.scale(s,s),c=e.getTransform(),e.translate(-c.e/c.a,(-c.f+r.current.height/2-u/2)/c.d)}Ne(),y("image load"),ue||Ge(!0)}},[ue,Ie,He,y,q]),Q=g(()=>{if(r.current){if(v.current!==null){let e=v.current.x/r.current.clientWidth,t=v.current.y/r.current.clientHeight;v.current={x:e*r.current.width,y:t*r.current.height},F()}r.current.width=r.current.clientWidth,r.current.height=r.current.clientHeight,Ne(),ze()}},[ze,F]);w(()=>(window.addEventListener("resize",Q),()=>{window.removeEventListener("resize",Q)}),[Q]);let We=g(()=>{let e=k();if(e===null)return;let t;M.current&&(t=N(M.current)),t?typeof t.props.onClick=="function"&&t.props.onClick():typeof m=="function"&&m(e)},[m]),je=g(e=>{let t=k();if(t===null)return;let n=N(e);n&&typeof n.props.onDragTick=="function"&&n.props.onDragTick(t)},[]),Ke=g(e=>{let t=k();if(t===null)return;let n=N(e);if(!n)return;let o=ie();o?(typeof n.props.onDragCancel=="function"&&n.props.onDragCancel(),typeof o.props.onDrop=="function"&&o.props.onDrop(n.props.markerKey)):typeof n.props.onDragEnd=="function"&&n.props.onDragEnd(t)},[ie]),G=g(e=>{if(!r.current)return;let t=r.current.getContext("2d");if(!t)return;let n=k(),o=r.current.getBoundingClientRect();if(e&&(v.current={x:e.clientX-o.x,y:e.clientY-o.y},F()),!ne.current){ae();return}if(+new Date>Y.current+Ae&&(z.current=!0),M.current)typeof Y.current=="number"&&+new Date>Y.current+R&&je(M.current);else{let u=k();if(u===null||n===null||!h.current)return;let i=t.getTransform(),a=u.x-n.x,c=u.y-n.y;if(a>0){let s=o.width-T;i.e>s?a=0:i.e+a>s&&(a=s-i.e)}else if(a<0){let s=-(h.current.width*i.a)+T;i.e<s?a=0:i.e+a<s&&(a=s-i.e)}if(c>0){let s=o.height-T;i.f>s?c=0:i.f+c>s&&(c=s-i.f)}else if(c<0){let s=-(h.current.height*i.d)+T;i.f<s?c=0:i.f+c<s&&(c=s-i.f)}t.translate(a,c),y("pan")}},[Ae,R,T,je,y,ae,F]);w(()=>(document.addEventListener("mousemove",G,!1),()=>{document.removeEventListener("mousemove",G,!1)}),[G]);let Ee=K(()=>()=>{xe.current&&window.clearTimeout(xe.current),M.current&&z.current&&typeof Y.current=="number"&&+new Date>Y.current+R&&Ke(M.current),M.current=null,ne.current=null,z.current=!1,y("mouse up")},[R,Ke,y]);w(()=>(document.addEventListener("mouseup",Ee,!1),()=>{document.removeEventListener("mouseup",Ee,!1)}),[Ee]);let Pe=g(()=>{$.current=!0,document.body.style.mozUserSelect="none",document.body.style.webkitUserSelect="none",document.body.style.userSelect="none",ne.current=k(),xe.current=window.setTimeout(G,R),Y.current=+new Date,z.current=!1,M.current=X()},[R,G,X]);w(()=>{let e=r.current;return e?(e.addEventListener("mousedown",Pe,!1),()=>{e.removeEventListener("mousedown",Pe,!1)}):()=>{}},[Pe]);let Re=g(()=>{z.current||We()},[We]);w(()=>{let e=r.current;return e?(e.addEventListener("mouseup",Re),()=>{e.removeEventListener("mouseup",Re)}):()=>{}},[Re]);let Ye=K(()=>e=>{if(!r.current)return;let t=r.current.getContext("2d");if(!t)return;let n=k();if(n===null)return;t.translate(n.x,n.y);let o=at**e,u=t.getTransform();if(o>1){let i=Math.max(u.a,u.d);i*o>we&&(o=we/i)}else{let i=Math.max(u.a,u.d);i*o<Me&&(o=Me/i)}t.scale(o,o),t.translate(-n.x,-n.y),y("zoom")},[we,Me,y]),J=g(e=>{$.current=!0;let t=e.deltaY;return t?t/=40:e.detail?t=-e.detail:t=0,t=-t,t&&Ye(t),e.preventDefault(),e.stopPropagation(),!1},[Ye]);w(()=>{let e=r.current;return e?(e.addEventListener("DOMMouseScroll",J,!1),e.addEventListener("mousewheel",J,!1),()=>{e.removeEventListener("DOMMouseScroll",J,!1),e.removeEventListener("mousewheel",J,!1)}):()=>{}},[J]);let De=g(e=>{if(e.which===ut){if(typeof M.current=="string"){let t=N(M.current);t&&typeof t.props.onDragCancel=="function"&&t.props.onDragCancel()}ne.current=null,z.current=!1,y("mouse down")}},[y]);w(()=>(document.addEventListener("keydown",De,!1),()=>{document.removeEventListener("keydown",De,!1)}),[De]);let ke=g(e=>{if(!r.current)return;let t=r.current.getBoundingClientRect();e&&(v.current={x:e.clientX-t.x,y:e.clientY-t.y},F())},[F]);w(()=>{let e=r.current;return e?(e.addEventListener("dragover",ke,!1),()=>{e.removeEventListener("dragover",ke,!1)}):()=>{}},[ke]);let Se=g(()=>{if(!r.current)return;let t=O(r.current.getContext("2d"));if(!t)return;let n;if(M.current)n=N(M.current);else{let o=X();o&&(n=N(o))}if(n)typeof n.props.onDoubleClick=="function"&&n.props.onDoubleClick();else if(v.current&&typeof b=="function"){let o=t.transformedPoint(v.current.x,v.current.y);b(o)}},[b,X]);w(()=>{let e=r.current;return e?(e.addEventListener("dblclick",Se),()=>{e.removeEventListener("dblclick",Se)}):()=>{}},[Se]),w(()=>{ye.current=!1,h.current=new Image,h.current.src=d,h.current.onload=le,y("new image")},[d,le,y]),w(()=>{h.current&&(h.current.onload=le)},[le]),w(()=>{Q()},[Q]);let fe=g(e=>{if($.current){se.current=null,$.current=!1,oe.current=!1;return}if(!r.current){window.requestAnimationFrame(fe);return}let t=r.current.getBoundingClientRect(),n=r.current.getContext("2d");if(!n)return;let o=n.getTransform();se.current||(se.current=e,Ce.current=e);let u=e-Ce.current;Ce.current=e;let i=!0;if(ce.current){let a={x:(t.width/2-o.e)/o.a,y:(t.height/2-o.f)/o.d},c=ce.current,s={x:c.x-a.x,y:c.y-a.y};if(i=Math.sqrt(s.x**2+s.y**2)<1,i)n.translate(-s.x,-s.y),ce.current=null;else{let P=Math.min(Math.max(u*.005,0),1);n.translate(-s.x*P,-s.y*P)}}y("animation"),oe.current=!i,i||window.requestAnimationFrame(fe)},[y]),Fe=g(e=>{$.current=!1,se.current=null,ce.current=e,oe.current||window.requestAnimationFrame(fe),oe.current=!0},[fe]);return w(()=>{he&&Fe(he)},[he,Fe]),ge.createElement("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden"}},ge.createElement("canvas",{ref:e=>{e&&(r.current=e,typeof re=="function"?re(e):re&&(re.current=e))},style:{width:"100%",height:"100%"}}),ge.createElement("div",{ref:be},$e))});export{Le as DropZone,lt as Map,Te as Marker,pe as Tooltip};
/*! Bundled license information:

classnames/index.js:
  (*!
  	Copyright (c) 2018 Jed Watson.
  	Licensed under the MIT License (MIT), see
  	http://jedwatson.github.io/classnames
  *)
*/
//# sourceMappingURL=index.js.map
